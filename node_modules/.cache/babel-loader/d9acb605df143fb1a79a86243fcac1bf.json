{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _defineProperty from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\wilfr\\\\OneDrive\\\\Documents\\\\maxitapbotlatestversionv2\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect}from'react';import{doc,updateDoc,arrayUnion,increment}from'firebase/firestore';import{db}from'../firebase/firestore';// Make sure to import your Firestore configuration\nimport{useUser}from\"../context/userContext\";// Ensure you have a context to get the user id\nimport{IoCheckmarkCircleSharp}from'react-icons/io5';import{CiNoWaitingSign}from\"react-icons/ci\";import{texts}from\"../constants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ManualTasks=function ManualTasks(){var _useState=useState({}),_useState2=_slicedToArray(_useState,2),showVerifyButtons=_useState2[0],setShowVerifyButtons=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),countdowns=_useState4[0],setCountdowns=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),buttonText=_useState6[0],setButtonText=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),modalOpen=_useState8[0],setModalOpen=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),modalMessage=_useState10[0],setModalMessage=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),claiming=_useState12[0],setClaiming=_useState12[1];var _useState13=useState({}),_useState14=_slicedToArray(_useState13,2),submitted=_useState14[0],setSubmitted=_useState14[1];var _useUser=useUser(),userId=_useUser.id,manualTasks=_useUser.manualTasks,userManualTasks=_useUser.userManualTasks,setUserManualTasks=_useUser.setUserManualTasks,setBalance=_useUser.setBalance;// Assuming 'id' is the user's document ID in Firestore\nvar _useState15=useState(0),_useState16=_slicedToArray(_useState15,2),claimedBonus=_useState16[0],setClaimedBonus=_useState16[1];// New state to store the claimed bonus amount\nvar _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),congrats=_useState18[0],setCongrats=_useState18[1];var performTask=function performTask(taskId){var task=manualTasks.find(function(task){return task.id===taskId;});if(task){window.open(task.link,'_blank');setTimeout(function(){setShowVerifyButtons(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},taskId,true));});},2000);// Enable the verify button after 2 seconds\n}};var startCountdown=function startCountdown(taskId){setCountdowns(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},taskId,5));});setButtonText(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},taskId,'Verifying...'));});var countdownInterval=setInterval(function(){setCountdowns(function(prevCountdowns){var newCountdown=prevCountdowns[taskId]-1;if(newCountdown<=0){clearInterval(countdownInterval);setCountdowns(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},taskId,null));});// Hide the timer\nsetButtonText(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},taskId,'Verifying'));});setModalMessage(/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex justify-center flex-col items-center space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-full items-center justify-center flex flex-col space-y-2\",children:[/*#__PURE__*/_jsx(CiNoWaitingSign,{size:32,className:\"text-accent\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-center\",children:\"Wait 30 minutes for moderation check to claim bonus!!\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"pb-6 text-[#9a96a6] text-[15px] w-full text-center\",children:\"If you have not performed this task make sure you do so within 30 minutes to claim your bonus!\"})]}));setModalOpen(true);// Save the task to the user's document\nvar saveTaskToUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var userDocRef;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;userDocRef=doc(db,'telegramUsers',userId);_context.next=4;return updateDoc(userDocRef,{manualTasks:arrayUnion({taskId:taskId,completed:false})});case 4:console.log(\"Task \".concat(taskId,\" added to user's manualTasks collection\"));_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);console.error(\"Error adding task to user's document: \",_context.t0);case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function saveTaskToUser(){return _ref.apply(this,arguments);};}();saveTaskToUser();// Set submitted to true and save to local storage\nsetSubmitted(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},taskId,true));});localStorage.setItem(\"submitted_\".concat(taskId),true);return _objectSpread(_objectSpread({},prevCountdowns),{},_defineProperty({},taskId,null));}return _objectSpread(_objectSpread({},prevCountdowns),{},_defineProperty({},taskId,newCountdown));});},1000);};var claimTask=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(taskId){var task,userDocRef;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setClaiming(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},taskId,true));});_context2.prev=1;task=manualTasks.find(function(task){return task.id===taskId;});userDocRef=doc(db,'telegramUsers',userId);_context2.next=6;return updateDoc(userDocRef,{manualTasks:userManualTasks.map(function(task){return task.taskId===taskId?_objectSpread(_objectSpread({},task),{},{completed:true}):task;}),balance:increment(task.bonus)});case 6:setBalance(function(prevBalance){return prevBalance+task.bonus;});console.log(\"Task \".concat(taskId,\" marked as completed\"));setUserManualTasks(function(prevTasks){return prevTasks.map(function(task){return task.taskId===taskId?_objectSpread(_objectSpread({},task),{},{completed:true}):task;});});setModalMessage(/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex justify-center flex-col items-center space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-full items-center justify-center flex flex-col space-y-2\",children:[/*#__PURE__*/_jsx(IoCheckmarkCircleSharp,{size:32,className:\"text-accent\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-center\",children:\"Let's go!!\"})]}),/*#__PURE__*/_jsxs(\"h3\",{className:\"font-medium text-[20px] text-[#ffffff] pt-2 pb-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-accent\",children:[\"+\",formatNumberCliam(task.bonus)]}),\" \",texts.projectSymbol,\" CLAIMED\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"pb-6 text-[15px] w-full text-center\",children:[\"Keep performing new tasks! something huge is coming! Perform more and earn more \",texts.projectSymbol,\" now!\"]})]}));setModalOpen(true);setClaimedBonus(task.bonus);setCongrats(true);setTimeout(function(){setCongrats(false);},4000);_context2.next=19;break;case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](1);console.error(\"Error updating task status to completed: \",_context2.t0);case 19:setClaiming(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},taskId,false));});case 20:case\"end\":return _context2.stop();}}},_callee2,null,[[1,16]]);}));return function claimTask(_x){return _ref2.apply(this,arguments);};}();var closeModal=function closeModal(){setModalOpen(false);};useEffect(function(){var submittedStates=manualTasks.reduce(function(acc,task){var submittedState=localStorage.getItem(\"submitted_\".concat(task.id))==='true';acc[task.id]=submittedState;return acc;},{});setSubmitted(submittedStates);},[manualTasks]);var confirmTask=function confirmTask(taskId){// Logic for confirming the task can be added here\nconsole.log(\"Task \".concat(taskId,\" confirmed\"));};var formatNumber=function formatNumber(num){if(num<100000){return new Intl.NumberFormat().format(num).replace(/,/g,\" \");}else if(num<1000000){return new Intl.NumberFormat().format(num).replace(/,/g,\" \");}else{return(num/1000000).toFixed(3).replace(\".\",\".\")+\" M\";}};var formatNumberCliam=function formatNumberCliam(num){if(num<100000){return new Intl.NumberFormat().format(num).replace(/,/g,\" \");}else if(num<1000000){return new Intl.NumberFormat().format(num).replace(/,/g,\" \");}else{return(num/1000000).toFixed(3).replace(\".\",\".\")+\" M\";}};return/*#__PURE__*/_jsxs(_Fragment,{children:[manualTasks.sort(function(a,b){return a.id-b.id;})// Sort tasks by id in ascending order\n.map(function(task){var userTask=userManualTasks.find(function(t){return t.taskId===task.id;});var isTaskCompleted=userTask?userTask.completed:false;var isTaskSaved=!!userTask;return/*#__PURE__*/_jsx(\"div\",{className:\"w-[93%] rounded-[25px] bg-gradient-to-r from-[#454545] to-[#575349] p-[1px]\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex h-full w-full flex-col bg-[#2d2d2d] justify-center rounded-[24px] py-4 pl-12 pr-4 relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-[60px] h-[60px] rounded-[12px] p-2 absolute bgs-[#8a8a8a] bg-[#6b69699c] left-[-7%] todp-[40px] flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"img\",{alt:\"engy\",src:task.icon,className:\"w-[40px] rounded-[8px]\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex w-full flex-col justify-between h-full space-y-2\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-[15px] text-nowrap line-clamp-1 mr-[5px] font-semibold\",children:task.title}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center w-fit space-x-1 text-primary text-[14px] font-semibold\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-[10px] h-[10px] bg-accent rounded-full flex items-center\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"\",children:[\"+\",formatNumber(task.bonus)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex items-center text-[14px] justify-between relative\",children:[!isTaskSaved&&!isTaskCompleted&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return performTask(task.id);},className:\"w-fit py-[6px] px-4 font-medium bg-[#595959cc] hover:bg-[#8a8a8a] text-[#fff] hover:text-[#000] ease-in duration-200 rounded-[6px]\",children:\"Perform\"}),countdowns[task.id]===undefined&&/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return startCountdown(task.id);},className:\"\".concat(submitted[task.id]?\"bg-btn4 text-[#000]\":buttonText[task.id]||\"bg-btn4 text-[#000]\",\" \").concat(!showVerifyButtons[task.id]?\"!bg-btn2 !text-[#888]\":\"bg-btn4 text-[#000]\",\" w-fit py-[6px] px-4 font-medium rounded-[6px]\"),disabled:!showVerifyButtons[task.id],children:submitted[task.id]?'Verifying':buttonText[task.id]||'Verify'})]}),isTaskSaved&&!isTaskCompleted&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return confirmTask(task.id);},className:\"w-fit py-[6px] px-[1.2rem] font-medium bg-[#494949] text-[#b8b8b8] rounded-[6px]\",children:\"Done\"}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return claimTask(task.id);},className:\"w-fit py-[6px] px-4 font-medium bg-btn4 rounded-[6px]\",disabled:claiming[task.id],children:claiming[task.id]?'Claiming...':'Claim'})]}),countdowns[task.id]!==null&&countdowns[task.id]!==undefined&&/*#__PURE__*/_jsxs(\"span\",{className:\"w-fit py-[6px] px-4 font-medium rounded-[6px] bg-[#0000004a] text-[#888]\",children:[\"checking \",countdowns[task.id],\"s\"]}),countdowns[task.id]===null&&/*#__PURE__*/_jsx(\"button\",{className:\"w-fit py-[6px] px-4 font-medium rounded-[6px] bg-btn4\",children:\"Verifying\"}),isTaskCompleted&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-fit py-[6px] px-4 font-medium bg-[#494949] text-[#b8b8b8] rounded-[6px]\",children:\"Completed\"}),/*#__PURE__*/_jsx(\"span\",{className:\"mr-[6px]\",children:/*#__PURE__*/_jsx(IoCheckmarkCircleSharp,{size:24,className:\"text-accent\"})})]})]})]})]})},task.id);}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full absolute top-[50px] left-0 right-0 flex justify-center z-50 pointer-events-none select-none\",children:congrats?/*#__PURE__*/_jsx(\"img\",{src:\"/congrats.gif\",alt:\"congrats\",className:\"w-[80%]\"}):/*#__PURE__*/_jsx(_Fragment,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(modalOpen===true?\"visible\":\"invisible\",\" fixed top-[-12px] bottom-0 left-0 z-40 right-0 h-[100vh] bg-[#00000042] flex justify-center items-center backdrop-blur-[6px] px-4\"),children:/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(modalOpen===true?\"opacity-100 mt-0 ease-in duration-300\":\"opacity-0 mt-[100px]\",\" w-full bg-modal relative rounded-[16px] flex flex-col justify-center p-8\"),children:[modalMessage,/*#__PURE__*/_jsx(\"div\",{className:\"w-full flex justify-center\",children:/*#__PURE__*/_jsx(\"button\",{onClick:closeModal,className:\"bg-btn4 w-fit py-[10px] px-6 flex items-center justify-center text-center rounded-[12px] font-medium text-[16px]\",children:\"Continue tasks\"})})]})}),claimedBonus?/*#__PURE__*/_jsx(\"div\",{className:\"hidden\"}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"hidden\"})})]});};export default ManualTasks;","map":null,"metadata":{},"sourceType":"module"}