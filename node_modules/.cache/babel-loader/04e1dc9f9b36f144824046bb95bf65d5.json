{"ast":null,"code":"import _createForOfIteratorHelper from \"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _objectWithoutProperties from \"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";\nvar _excluded = [\"container\"];\nimport { resize } from '../resize/index.mjs';\nimport { createScrollInfo } from './info.mjs';\nimport { createOnScrollHandler } from './on-scroll-handler.mjs';\nimport { frame, cancelFrame, frameData } from '../../../frameloop/frame.mjs';\nvar scrollListeners = new WeakMap();\nvar resizeListeners = new WeakMap();\nvar onScrollHandlers = new WeakMap();\n\nvar getEventTarget = function getEventTarget(element) {\n  return element === document.documentElement ? window : element;\n};\n\nfunction scrollInfo(onScroll) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$container = _ref.container,\n      container = _ref$container === void 0 ? document.documentElement : _ref$container,\n      options = _objectWithoutProperties(_ref, _excluded);\n\n  var containerHandlers = onScrollHandlers.get(container);\n  /**\n   * Get the onScroll handlers for this container.\n   * If one isn't found, create a new one.\n   */\n\n  if (!containerHandlers) {\n    containerHandlers = new Set();\n    onScrollHandlers.set(container, containerHandlers);\n  }\n  /**\n   * Create a new onScroll handler for the provided callback.\n   */\n\n\n  var info = createScrollInfo();\n  var containerHandler = createOnScrollHandler(container, onScroll, info, options);\n  containerHandlers.add(containerHandler);\n  /**\n   * Check if there's a scroll event listener for this container.\n   * If not, create one.\n   */\n\n  if (!scrollListeners.has(container)) {\n    var measureAll = function measureAll() {\n      var _iterator = _createForOfIteratorHelper(containerHandlers),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var handler = _step.value;\n          handler.measure();\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    };\n\n    var updateAll = function updateAll() {\n      var _iterator2 = _createForOfIteratorHelper(containerHandlers),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var handler = _step2.value;\n          handler.update(frameData.timestamp);\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n    };\n\n    var notifyAll = function notifyAll() {\n      var _iterator3 = _createForOfIteratorHelper(containerHandlers),\n          _step3;\n\n      try {\n        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n          var handler = _step3.value;\n          handler.notify();\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n    };\n\n    var _listener = function _listener() {\n      frame.read(measureAll, false, true);\n      frame.read(updateAll, false, true);\n      frame.update(notifyAll, false, true);\n    };\n\n    scrollListeners.set(container, _listener);\n    var target = getEventTarget(container);\n    window.addEventListener(\"resize\", _listener, {\n      passive: true\n    });\n\n    if (container !== document.documentElement) {\n      resizeListeners.set(container, resize(container, _listener));\n    }\n\n    target.addEventListener(\"scroll\", _listener, {\n      passive: true\n    });\n  }\n\n  var listener = scrollListeners.get(container);\n  frame.read(listener, false, true);\n  return function () {\n    var _a;\n\n    cancelFrame(listener);\n    /**\n     * Check if we even have any handlers for this container.\n     */\n\n    var currentHandlers = onScrollHandlers.get(container);\n    if (!currentHandlers) return;\n    currentHandlers.delete(containerHandler);\n    if (currentHandlers.size) return;\n    /**\n     * If no more handlers, remove the scroll listener too.\n     */\n\n    var scrollListener = scrollListeners.get(container);\n    scrollListeners.delete(container);\n\n    if (scrollListener) {\n      getEventTarget(container).removeEventListener(\"scroll\", scrollListener);\n      (_a = resizeListeners.get(container)) === null || _a === void 0 ? void 0 : _a();\n      window.removeEventListener(\"resize\", scrollListener);\n    }\n  };\n}\n\nexport { scrollInfo };","map":null,"metadata":{},"sourceType":"module"}