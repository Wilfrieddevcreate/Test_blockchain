{"ast":null,"code":"import _toConsumableArray from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _defineProperty from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\wilfr\\\\OneDrive\\\\Documents\\\\maxitapbotlatestversionv2\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect}from'react';import{db}from'../firebase/firestore';// adjust the path as needed\nimport{collection,doc,getDoc,updateDoc,deleteDoc,query,where,getDocs,orderBy,limit,startAfter}from\"firebase/firestore\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var UserManagementPanel=function UserManagementPanel(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),searchTerm=_useState2[0],setSearchTerm=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),editUserData=_useState6[0],setEditUserData=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),successMessage=_useState8[0],setSuccessMessage=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),errorMessage=_useState10[0],setErrorMessage=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isEditing=_useState12[0],setIsEditing=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),users=_useState14[0],setUsers=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),lastVisible=_useState16[0],setLastVisible=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),loading=_useState18[0],setLoading=_useState18[1];var _useState19=useState({}),_useState20=_slicedToArray(_useState19,2),dropdownVisible=_useState20[0],setDropdownVisible=_useState20[1];// Add state for dropdown visibility\nvar handleSearch=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var userFound,usernameQuery,usernameSnapshot,userData,userDoc,_userData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;userFound=false;// Search by username\nusernameQuery=query(collection(db,\"telegramUsers\"),where(\"username\",\"==\",searchTerm));_context.next=5;return getDocs(usernameQuery);case 5:usernameSnapshot=_context.sent;if(!usernameSnapshot.empty){userData=usernameSnapshot.docs[0].data();setUser(_objectSpread({id:usernameSnapshot.docs[0].id},userData));setEditUserData(_objectSpread({},userData));userFound=true;}// Search by userId if not found by username\nif(userFound){_context.next=12;break;}_context.next=10;return getDoc(doc(db,\"telegramUsers\",searchTerm));case 10:userDoc=_context.sent;if(userDoc.exists()){_userData=userDoc.data();setUser(_objectSpread({id:userDoc.id},_userData));setEditUserData(_objectSpread({},_userData));userFound=true;}case 12:if(!userFound){setUser(null);setEditUserData(null);setErrorMessage('No user found');}else{setErrorMessage('');}_context.next=19;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](0);console.error(\"Error searching user: \",_context.t0);setErrorMessage('Error searching user');case 19:case\"end\":return _context.stop();}}},_callee,null,[[0,15]]);}));return function handleSearch(){return _ref.apply(this,arguments);};}();var handleInputChange=function handleInputChange(e){var _e$target=e.target,name=_e$target.name,value=_e$target.value;setEditUserData(_objectSpread(_objectSpread({},editUserData),{},_defineProperty({},name,name==='balance'||name==='tapBalance'?Number(value):value)));};var handleUpdateUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var userDoc;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;userDoc=doc(db,\"telegramUsers\",user.id);_context2.next=4;return updateDoc(userDoc,editUserData);case 4:setSuccessMessage('User successfully updated!');setUser(_objectSpread({id:user.id},editUserData));setIsEditing(false);_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);console.error(\"Error updating user: \",_context2.t0);setErrorMessage('Error updating user');case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9]]);}));return function handleUpdateUser(){return _ref2.apply(this,arguments);};}();var handleDeleteUser=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(userId){var userDoc;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;userDoc=doc(db,\"telegramUsers\",userId);_context3.next=4;return deleteDoc(userDoc);case 4:setUsers(users.filter(function(user){return user.id!==userId;}));setSuccessMessage('User successfully deleted!');_context3.next=12;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);console.error(\"Error deleting user: \",_context3.t0);setErrorMessage('Error deleting user');case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function handleDeleteUser(_x){return _ref3.apply(this,arguments);};}();var fetchUsers=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var loadMore,usersRef,usersQuery,userSnapshot,lastVisibleDoc,fetchedUsers,_args4=arguments;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:loadMore=_args4.length>0&&_args4[0]!==undefined?_args4[0]:false;setLoading(true);_context4.prev=2;usersRef=collection(db,\"telegramUsers\");usersQuery=loadMore&&lastVisible?query(usersRef,orderBy(\"balance\",\"desc\"),startAfter(lastVisible),limit(50)):query(usersRef,orderBy(\"balance\",\"desc\"),limit(50));_context4.next=7;return getDocs(usersQuery);case 7:userSnapshot=_context4.sent;lastVisibleDoc=userSnapshot.docs[userSnapshot.docs.length-1];setLastVisible(lastVisibleDoc);fetchedUsers=userSnapshot.docs.map(function(doc){return _objectSpread({id:doc.id},doc.data());});setUsers(loadMore?[].concat(_toConsumableArray(users),_toConsumableArray(fetchedUsers)):fetchedUsers);_context4.next=18;break;case 14:_context4.prev=14;_context4.t0=_context4[\"catch\"](2);console.error(\"Error fetching users: \",_context4.t0);setErrorMessage('Error fetching users');case 18:_context4.prev=18;setLoading(false);return _context4.finish(18);case 21:case\"end\":return _context4.stop();}}},_callee4,null,[[2,14,18,21]]);}));return function fetchUsers(){return _ref4.apply(this,arguments);};}();useEffect(function(){fetchUsers();// eslint-disable-next-line \n},[]);var toggleDropdown=function toggleDropdown(userId){setDropdownVisible(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},userId,!prevState[userId]));});};var formatNumber=function formatNumber(num){if(num<100000){return new Intl.NumberFormat().format(num).replace(/,/g,\" \");}else if(num<1000000){return new Intl.NumberFormat().format(num).replace(/,/g,\" \");}else{return(num/1000000).toFixed(3).replace(\".\",\".\")+\" M\";}};return/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex flex-col space-y-4 h-[100vh] scroller pt-4 overflow-y-auto pb-[150px]\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-full sm:w-[50%] flex flex-col gap-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:searchTerm,onChange:function onChange(e){return setSearchTerm(e.target.value);},placeholder:\"Search by username or userId\",className:\"bg-[#4b4b4b] w-full placeholder:text-[#b9b9b9] text-[#e0e0e0] placeholder:text-[12px] text-[13px] placeholder:font-light h-[55px] border-none outline-none rounded-[10px] flex items-center px-6\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSearch,className:\"bg-[#f5bb5f] font-semibold text-[15px] rounded-[6px] w-full sm:w-[200px] h-fit px-4 py-3 text-[#000]\",children:\"Search\"}),errorMessage&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500\",children:errorMessage}),successMessage&&/*#__PURE__*/_jsx(\"p\",{className:\"text-green-500\",children:successMessage}),user&&/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex flex-col space-y-3 bg-cards p-4 rounded-[10px] text-[13px]\",children:[isEditing&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex w-full flex-wrap gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col w-full gap-1\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-[13px] pl-1 pb-[2px] font-medium\",children:\"User Balance\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"balance\",value:editUserData.balance,onChange:handleInputChange,placeholder:\"Balance\",className:\"bg-[#4b4b4b] placeholder:text-[#b9b9b9] text-[#e0e0e0] placeholder:text-[12px] text-[13px] placeholder:font-light h-[55px] border-none outline-none rounded-[10px] flex items-center px-6\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col w-full gap-1\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-[13px] pl-1 pb-[2px] font-medium\",children:\"User tap balance\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"tapBalance\",value:editUserData.tapBalance,onChange:handleInputChange,placeholder:\"Tap Balance\",className:\"bg-[#4b4b4b] placeholder:text-[#b9b9b9] text-[#e0e0e0] placeholder:text-[12px] text-[13px] placeholder:font-light h-[55px] border-none outline-none rounded-[10px] flex items-center px-6\"})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleUpdateUser,className:\"bg-green-500 rounded-[6px] text-white px-2 py-[12px]\",children:\"Update User\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Username:\"}),\" \",user.username]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"User Id:\"}),\" \",user.id]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"User balance:\"}),\" \",formatNumber(user.balance)]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"img\",{src:user.level.imgUrl,alt:\"User Level\",className:\"w-[14px] rounded-full h-[14px]\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"User level:\"}),\" \",user.level.name]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-wrap break-all\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"walletAddress:\"}),\" \",user.address]}),/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(dropdownVisible[user.id]?'hidden':'flex',\" w-full items-center justify-start gap-4\"),children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return setIsEditing(true);},className:\"bg-blue-500 rounded-[6px] text-white px-2 py-[6px]\",children:\"Edit User Details\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleDeleteUser,className:\"bg-red-500 rounded-[6px] text-white px-2 py-[6px]\",children:\"Delete User\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full sm:w-[50%] flex flex-col space-y-3\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-[20px] font-semibold\",children:\"Users List\"}),users.map(function(user,index){return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-[#4b4b4b] p-4 rounded-[10px] text-[13px] relative flex flex-col w-full space-y-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"flex w-full items-center space-x-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-[16px] h-[16px] flex justify-center items-center rounded-full bg-cards3\",children:/*#__PURE__*/_jsx(\"strong\",{children:index+1})}),\" \",/*#__PURE__*/_jsxs(\"span\",{className:\"line-clamp-1 font-semibold\",children:[user.username,\" | \",user.id]}),\" \"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1 psl-1\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/coin.webp\",alt:\"balance\",className:\"w-[14px] h-[14px] rounded-full\"}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold text-accent\",children:[\" \",formatNumber(user.balance)]})})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1 pls-[1px]\",children:[/*#__PURE__*/_jsx(\"img\",{src:user.level.imgUrl,alt:\"User Level\",className:\"w-[14px] rounded-full h-[14px]\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-secondary\",children:[user.level.name,\" level\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return toggleDropdown(user.id);},className:\"absolute top-2 right-2 bg-gray-700 text-white rounded-full p-2 h-[28px] w-[28px] flex items-center justify-center\",children:\"\\u22EE\"}),dropdownVisible[user.id]&&/*#__PURE__*/_jsxs(\"div\",{className:\"absolute z-10 top-8 right-2 bg-[#2e2e2e] text-primary rounded-md shadow-lg w-40\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){setUser(user);setEditUserData(user);setIsEditing(true);},className:\"block w-full text-left px-4 py-2 hover:bg-[#7a7a7a33]\",children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return handleDeleteUser(user.id);},className:\"block w-full text-left px-4 py-2 hover:bg-[#7a7a7a33]\",children:\"Delete\"})]})]},user.id);}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return fetchUsers(true);},disabled:loading,className:\"bg-[#f5bb5f] font-semibold text-[15px] rounded-[6px] w-full sm:w-[200px] h-fit px-4 py-3 text-[#000] mt-4\",children:loading?'Loading...':'Load More Users'})]})]});};export default UserManagementPanel;","map":null,"metadata":{},"sourceType":"module"}