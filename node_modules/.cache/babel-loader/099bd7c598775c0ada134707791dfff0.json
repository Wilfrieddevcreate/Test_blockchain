{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\wilfr\\\\OneDrive\\\\Documents\\\\maxitapbotlatestversionv2\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useEffect,useRef}from\"react\";import{PiSpinnerBallDuotone}from\"react-icons/pi\";import{useUser}from\"../context/userContext\";import{IoCheckmarkCircleSharp,IoClose}from\"react-icons/io5\";import{doc,updateDoc}from'firebase/firestore';import{db}from'../firebase/firestore';import{images,texts}from\"../constants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var SlotMachine=function SlotMachine(){var tMax=3000;// animation time, ms\nvar height=210;var reels=[[\"/bnb2.webp\",\"/notcoin.jpg\",\"/bitcoin.png\"],[\"/bnb2.webp\",\"/notcoin.jpg\",\"/bitcoin.png\"],[\"/bnb2.webp\",\"/notcoin.jpg\",\"/bitcoin.png\"]];var _useState=useState([]),_useState2=_slicedToArray(_useState,2),speeds=_useState2[0],setSpeeds=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),r=_useState4[0],setR=_useState4[1];var _useState5=useState(\"Press Spin to start\"),_useState6=_slicedToArray(_useState5,2),msg=_useState6[0],setMsg=_useState6[1];var _useState7=useState(undefined),_useState8=_slicedToArray(_useState7,2),start=_useState8[0],setStart=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),points=_useState10[0],setPoints=_useState10[1];// State for user's points\nvar $reelsRef=useRef([]);var animationFrameId=useRef(null);var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),openModal=_useState12[0],setOpenModal=_useState12[1];var _useUser=useUser(),id=_useUser.id,balance=_useUser.balance,setBalance=_useUser.setBalance,spinLimit=_useUser.spinLimit,setSpinLimit=_useUser.setSpinLimit,tapBalance=_useUser.tapBalance,setTapBalance=_useUser.setTapBalance;var modalRef=useRef(null);var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),openClaim=_useState14[0],setOpenClaim=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),congrats=_useState16[0],setCongrats=_useState16[1];// Probability of winning (30% chance to win)\nvar winProbability=0.3;var closeModalPay=function closeModalPay(event){if(modalRef.current&&!modalRef.current.contains(event.target)){setOpenModal(false);}};useEffect(function(){if(!id){if(openModal){document.addEventListener('mousedown',closeModalPay);}else{document.removeEventListener('mousedown',closeModalPay);}return function(){document.removeEventListener('mousedown',closeModalPay);};}// eslint-disable-next-line \n},[openModal,id]);useEffect(function(){if(start!==undefined){var animate=function animate(now){if(!start)setStart(now);var t=now-start||0;for(var i=0;i<3;++i){$reelsRef.current[i].scrollTop=(speeds[i]/tMax/2*(tMax-t)*(tMax-t)+r[i])%height|0;}if(t<tMax){animationFrameId.current=requestAnimationFrame(animate);}else{setStart(undefined);check();}};animationFrameId.current=requestAnimationFrame(animate);return function(){if(animationFrameId.current){cancelAnimationFrame(animationFrameId.current);}};}// eslint-disable-next-line\n},[start,speeds,r]);var handleStart=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var newSpeeds,newR,shouldWin,winValue,i,_i,newSpinLimit,userRef;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(start!==undefined||spinLimit<=0)){_context.next=2;break;}return _context.abrupt(\"return\");case 2:newSpeeds=[];newR=[];// Determine if this spin should result in a win\nshouldWin=Math.random()<winProbability;if(shouldWin){// Randomly select a winning reel value (1, 2, or 3)\nwinValue=Math.floor(Math.random()*3);for(i=0;i<3;++i){newSpeeds[i]=Math.random()+0.5;newR[i]=winValue*(height/3);// Set the same value for all reels\n}}else{// Normal random behavior (no guaranteed win)\nfor(_i=0;_i<3;++_i){newSpeeds[_i]=Math.random()+0.5;newR[_i]=(Math.random()*3|0)*(height/3);}}newSpinLimit=spinLimit-1;if(!id){_context.next=18;break;}if(!(spinLimit>0)){_context.next=18;break;}_context.prev=9;userRef=doc(db,'telegramUsers',id.toString());_context.next=13;return updateDoc(userRef,{spinLimit:newSpinLimit,slotTimeStamp:new Date()});case 13:_context.next=18;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](9);console.error('Error updating Spin Limit:',_context.t0);case 18:;setSpeeds(newSpeeds);setR(newR);setMsg(\"Spinning...\");setStart(performance.now());setSpinLimit(newSpinLimit);// Decrement the spin limit\ncase 24:case\"end\":return _context.stop();}}},_callee,null,[[9,15]]);}));return function handleStart(){return _ref.apply(this,arguments);};}();var formatNumber=function formatNumber(num){if(num<100000){return new Intl.NumberFormat().format(num).replace(/,/g,\" \");}else if(num<1000000){return new Intl.NumberFormat().format(num).replace(/,/g,\" \");}else{return(num/1000000).toFixed(3).replace(\".\",\".\")+\" M\";}};var check=function check(){var result=r.map(function(val){return(val/70+1)%3|0;});// Calculate the result based on the scroll positions\nif(result[0]===result[1]&&result[1]===result[2]){var award;switch(result[0]){case 0:// 111\naward=1000*30;break;case 1:// 222\naward=2000*30;break;case 2:// 333\naward=2500*40;break;default:award=0;}setPoints(function(prevPoints){return prevPoints+award;});// Update the user's points\nsetMsg(/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"span\",{className:\"text-primary\",children:[\"Congratulations! You won \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-accent text-nowrap\",children:formatNumber(award)}),\" points, Click on Claim now!\"]})}));}else{setMsg(\"No luck, try again!\");}};var handleClaim=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var userRef;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:userRef=doc(db,'telegramUsers',id.toString());_context2.prev=1;_context2.next=4;return updateDoc(userRef,{balance:balance+points,tapBalance:tapBalance+points});case 4:setBalance(function(prevBalance){return prevBalance+points;});setTapBalance(function(prevTapBalance){return prevTapBalance+points;});console.log('Points claimed successfully');_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);console.error('Error updating balance and energy:',_context2.t0);case 12:openClaimer();case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[1,9]]);}));return function handleClaim(){return _ref2.apply(this,arguments);};}();var openClaimer=function openClaimer(){setOpenClaim(true);setCongrats(true);setTimeout(function(){setCongrats(false);},4000);};var closeClaimer=function closeClaimer(){setOpenClaim(false);setPoints(0);// Reset points after claiming\n};var calculateTimeRemaining=function calculateTimeRemaining(){var now=new Date();var nextDate=new Date(now.getFullYear(),now.getMonth(),now.getDate()+1);var timeDiff=nextDate-now;var hours=Math.floor(timeDiff/(1000*60*60));var minutes=Math.floor(timeDiff%(1000*60*60)/(1000*60));var seconds=Math.floor(timeDiff%(1000*60)/1000);return{hours:hours,minutes:minutes,seconds:seconds};};var _useState17=useState(calculateTimeRemaining()),_useState18=_slicedToArray(_useState17,2),timeRemaining=_useState18[0],setTimeRemaining=_useState18[1];useEffect(function(){var interval=setInterval(function(){setTimeRemaining(calculateTimeRemaining());},1000);return function(){return clearInterval(interval);};// Clear interval on component unmount\n},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex flex-col space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{id:\"sm\",className:\"w-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex justify-between items-center pb-2 px-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"flex items-center mt-[-1px]\",children:/*#__PURE__*/_jsx(\"img\",{src:images.logo,className:\"w-[16px] rounded-full\",alt:\"engagecoin\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"text-[#fff] font-semibold text-[16px]\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"pl-[4px]\",children:[formatNumber(points),\" \",/*#__PURE__*/_jsxs(\"span\",{className:\"text-secondary\",children:[texts.projectSymbol,\" \"]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center cursor-pointer space-x-1 text-[13px]\",children:[/*#__PURE__*/_jsx(PiSpinnerBallDuotone,{size:16,className:\"\"}),spinLimit<=0?/*#__PURE__*/_jsxs(\"span\",{className:\"\",children:[timeRemaining.hours,\"h : \",timeRemaining.minutes,\"m : \",timeRemaining.seconds,\"s\"]}):/*#__PURE__*/_jsxs(\"span\",{className:\"\",children:[spinLimit,\" spins left\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"group\",children:reels.map(function(reel,i){return/*#__PURE__*/_jsxs(\"div\",{className:\"reel\",ref:function ref(el){return $reelsRef.current[i]=el;},children:[/*#__PURE__*/_jsx(\"div\",{children:reel.map(function(item,j){return/*#__PURE__*/_jsx(\"span\",{className:\"h-[60px]\",children:/*#__PURE__*/_jsx(\"p\",{className:\"child\".concat(j),children:/*#__PURE__*/_jsx(\"img\",{src:item,alt:\"dfd\",className:\"w-full h-full rounded-full\"})})},j);})}),/*#__PURE__*/_jsx(\"div\",{children:reel.map(function(item,j){return/*#__PURE__*/_jsx(\"span\",{className:\"h-[60px]\",children:/*#__PURE__*/_jsx(\"p\",{className:\"child\".concat(j),children:/*#__PURE__*/_jsx(\"img\",{src:item,alt:\"dfd\",className:\"w-full h-full rounded-full\"})})},j);})})]},i);})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full flex justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-full flex justify-between items-center pt-4\",children:/*#__PURE__*/_jsx(\"button\",{onClick:handleClaim,disabled:points<=0,className:\"\".concat(points<=0?'bg-btn2 text-[#888]':'bg-btn4 text-[#000]',\" py-[16px] w-full cursor-pointer px-8 rounded-[16px] font-bold text-[16px]\"),children:\"Claim\"})})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-[15px] w-full text-center pt-4 px-4\",children:msg})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full flex justify-center items-center relative\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-[100px] h-[100px] bg-[#ba932069] flex items-center justify-center rounded-full\",children:spinLimit<=0?/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return setOpenModal(true);},className:\"bg-btn4 text-[#000] h-[90px] ease-in duration-300 w-[90px] font-bold text-[20px] rounded-full flex items-center justify-center\",children:\"SPIN\"}):/*#__PURE__*/_jsx(\"button\",{disabled:start!==undefined||spinLimit<=0// Disable the spin button if spins are exhausted\n,onClick:handleStart,className:\"\".concat(start!==undefined?'bg-[#78760e] animate-spin':'bg-btn4 text-[#000]',\" h-[90px] ease-in duration-300 w-[90px] font-bold text-[20px] rounded-full flex items-center justify-center\"),children:\"SPIN\"})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(openModal?'flex':'hidden',\" fixed bottom-0 left-0 z-40 right-0 h-[100vh] bg-[#303030c4] flex-col justify-end items-center\"),children:/*#__PURE__*/_jsx(\"div\",{ref:modalRef,className:\"w-full bg-divider shadowtop rounded-tl-[40px] rounded-tr-[40px] relative flex flex-col ease-in duration-300 transition-all justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex taskbg rounded-tl-[40px] rounded-tr-[40px] mt-[2px] justify-center relative flex-col items-center space-y-3 p-4 pt-20 pb-10\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return setOpenModal(false);},className:\"flex items-center justify-center h-[32px] w-[32px] rounded-full bg-[#383838] absolute right-6 top-4 text-center font-medium text-[16px]\",children:/*#__PURE__*/_jsx(IoClose,{size:20,className:\"text-[#9995a4]\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full bg-cards rounded-[16px] py-6 relative px-4 flex flex-col justify-center items-center\",children:[/*#__PURE__*/_jsx(PiSpinnerBallDuotone,{size:34,className:\"text-accent animate-spin\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-[#bfbfbf] font-medium px-8 text-[14px] w-full text-center\",children:\"Your next Spin starts in\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-[34px] font-semibold\",children:[timeRemaining.hours,\"h : \",timeRemaining.minutes,\"m : \",timeRemaining.seconds,\"s\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex justify-between items-center gap-2 px-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-[40%] h-[2px] bg-cards2\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-nowrap\",children:\"more luck \\uD83D\\uDCAA\"}),/*#__PURE__*/_jsx(\"div\",{className:\"w-[40%] h-[2px] bg-cards2\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full flex justify-center items-center flex-col space-y-2 pb-7\",children:/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return setOpenModal(false);},className:\"bg-btn4 w-full py-[18px] px-6 text-nowrap flex items-center justify-center text-center rounded-[12px] font-semibold text-[17px]\",children:\"Go back\"})})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full absolute top-[50px] flex justify-center z-50 pointer-events-none select-none\",children:congrats?/*#__PURE__*/_jsx(\"img\",{src:\"/congrats.gif\",alt:\"congrats\",className:\"w-[80%]\"}):/*#__PURE__*/_jsx(_Fragment,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(openClaim===true?\"visible\":\"invisible\",\" fixed top-[-12px] claimdiv bottom-0 left-0 z-40 right-0 h-[100vh] bg-[#00000042] flex flex-col justify-center items-center px-4\"),children:/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(openClaim===true?\"opacity-100 mt-0\":\"opacity-0 mt-[100px]\",\" w-full bg-modal rounded-[16px] relative flex flex-col ease-in duration-300 transition-all justify-center p-8\"),children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex justify-center flex-col items-center space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-full items-center justify-center flex flex-col space-y-2\",children:[/*#__PURE__*/_jsx(IoCheckmarkCircleSharp,{size:32,className:\"text-accent\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:\"Let's go!!\"})]}),/*#__PURE__*/_jsxs(\"h3\",{className:\"font-medium text-[24px] text-[#ffffff] pt-2 pb-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-accent\",children:[\"+\",points]}),\" MAX\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"pb-6 text-[#bfbfbf] text-[15px] w-full text-center\",children:[\"Keep grinding! something huge is coming! Get more \",texts.projectSymbol,\" now!\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full flex justify-center\",children:/*#__PURE__*/_jsx(\"button\",{onClick:closeClaimer,className:\"bg-btn4 text-[#000] w-fit py-[10px] px-6 flex items-center justify-center text-center rounded-[12px] font-medium text-[16px]\",children:\"Spin more!\"})})]})})})]});};export default SlotMachine;","map":null,"metadata":{},"sourceType":"module"}