{"ast":null,"code":"import _toConsumableArray from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/wilfr/OneDrive/Documents/maxitapbotlatestversionv2/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\wilfr\\\\OneDrive\\\\Documents\\\\maxitapbotlatestversionv2\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useEffect,useRef,useState}from'react';import{IoCheckmarkCircle,IoCheckmarkCircleSharp,IoClose}from\"react-icons/io5\";import{AiTwotoneInfoCircle}from\"react-icons/ai\";import{TonConnectButton,TonConnectError,useTonConnectUI,useTonWallet}from'@tonconnect/ui-react';import{useUser}from'../context/userContext';import{doc,updateDoc,arrayUnion}from\"firebase/firestore\";import{db}from'../firebase/firestore';import{texts}from\"../constants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Specials=function Specials(){var _useUser=useUser(),id=_useUser.id,purchasedCards=_useUser.purchasedCards,specialCards=_useUser.specialCards,setPurchasedCards=_useUser.setPurchasedCards,walletAssets=_useUser.walletAssets,setWalletAssets=_useUser.setWalletAssets,deposits=_useUser.deposits,setDeposits=_useUser.setDeposits;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),openUpgrade=_useState2[0],setOpenUpgrade=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),selectedCard=_useState4[0],setSelectedCard=_useState4[1];// State to store selected card\nvar infoRefTwo=useRef(null);var wallet=useTonWallet();var _useTonConnectUI=useTonConnectUI(),_useTonConnectUI2=_slicedToArray(_useTonConnectUI,1),tonConnectUI=_useTonConnectUI2[0];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),messageColor=_useState8[0],setMessageColor=_useState8[1];// eslint-disable-next-line \nvar _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),isLoading=_useState10[0],setIsLoading=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),congrats=_useState12[0],setCongrats=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),showCongratsModal=_useState14[0],setShowCongratsModal=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),congratsMessage=_useState16[0],setCongratsMessage=_useState16[1];var _useState17=useState(\"Make Purchase\"),_useState18=_slicedToArray(_useState17,2),buttonText=_useState18[0],setButtonText=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),buttonDisabled=_useState20[0],setButtonDisabled=_useState20[1];useEffect(function(){var initializeTonConnect=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return tonConnectUI.connectionRestored;case 3:setIsLoading(false);_context.next=12;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);console.error('TonConnect initialization error:',_context.t0);if(_context.t0 instanceof TonConnectError){setMessage(\"TonConnect error: \".concat(_context.t0.message));}else{setMessage(\"An error occurred while connecting to TON. Please refresh the page and try again.\");}setMessageColor(\"red\");setIsLoading(false);case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,6]]);}));return function initializeTonConnect(){return _ref.apply(this,arguments);};}();initializeTonConnect();},[tonConnectUI]);var transaction=function transaction(cost){return{validUntil:Math.floor(Date.now()/1000)+300,// 5 minutes from now\nmessages:[{address:\"UQBVG55fi3FjPFBprk6KVknXV4STHrWph08-cMlHgC3SBuG8\",amount:cost// Cost of the selected card\n}]};};var handleClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,updatedWalletAssets,newDeposit,updatedDeposits,userRef;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setButtonText(\"Processing...\");setButtonDisabled(true);_context2.prev=2;_context2.next=5;return tonConnectUI.sendTransaction(transaction(selectedCard.cost));case 5:response=_context2.sent;console.log('Transaction sent successfully');console.log('Transaction response:',response);// Update TON balance in the state\nupdatedWalletAssets=walletAssets.map(function(asset){return asset.symbol==='TON'?_objectSpread(_objectSpread({},asset),{},{balance:asset.balance+selectedCard.profit}):asset;});// Add a new deposit to the deposits state\nnewDeposit={name:\"\".concat(selectedCard.title,\" Card\"),date:new Date(),amount:selectedCard.profit,completed:true};updatedDeposits=[].concat(_toConsumableArray(deposits),[newDeposit]);// Update the user's Firestore document with the purchased card\nuserRef=doc(db,'telegramUsers',id.toString());_context2.next=14;return updateDoc(userRef,{specialCards:arrayUnion({title:selectedCard.title,profit:selectedCard.profit,cost:selectedCard.cost,icon:selectedCard.icon,description:selectedCard.description,class:selectedCard.class}),walletAssets:updatedWalletAssets,'history.deposits':updatedDeposits});case 14:// Update local states\nsetWalletAssets(updatedWalletAssets);setDeposits(updatedDeposits);setPurchasedCards(function(prev){return[].concat(_toConsumableArray(prev),[selectedCard]);});setCongratsMessage(/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex justify-center flex-col items-center space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-full items-center justify-center flex flex-col space-y-2\",children:[/*#__PURE__*/_jsx(IoCheckmarkCircleSharp,{size:32,className:\"text-accent\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-center\",children:\"Congratulations!\"})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium text-[20px] text-[#ffffff] pt-2 pb-2 flex items-center space-x-1\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/ton.png\",alt:\"refd\",className:\"w-[22px]\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-accent\",children:selectedCard.profit}),\" \",/*#__PURE__*/_jsx(\"span\",{children:\"TON CLAIMED\"})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"pb-6 text-[15px] w-full text-center\",children:[\"Your claimed TON will be kept safe in your wallet till token launch. You can also swap your TON for more \",texts.projectSymbol,\" tokens or other listed assets in the wallets menu.\"]})]}));// Show the congrats modal\nsetShowCongratsModal(true);setOpenUpgrade(false);setCongrats(true);setTimeout(function(){setCongrats(false);},3000);// Show a success message\nsetMessage(\"Transaction sent successfully and card purchased!\");setMessageColor(\"green\");_context2.next=31;break;case 26:_context2.prev=26;_context2.t0=_context2[\"catch\"](2);console.error('Transaction error:',_context2.t0);if(_context2.t0 instanceof TonConnectError){if(_context2.t0.message.includes('Operation aborted')){setMessage(\"Transaction was cancelled or timed out. Please try again.\");setMessageColor(\"orange\");}else{console.error(\"TonConnect error: \".concat(_context2.t0.message));}}else{setMessage(\"An unexpected error occurred. Please try again.\");setMessageColor(\"red\");}if(_context2.t0.response){console.error('Error response data:',_context2.t0.response.data);}case 31:_context2.prev=31;// Re-enable the button and reset the text\nsetButtonText(\"Make Purchase\");setButtonDisabled(false);return _context2.finish(31);case 35:case\"end\":return _context2.stop();}}},_callee2,null,[[2,26,31,35]]);}));return function handleClick(){return _ref2.apply(this,arguments);};}();// const handleClick = async () => {\n//     setButtonText(\"Processing...\");\n//     setButtonDisabled(true);\n//     try {\n//         // Send the transaction\n//         const response = await tonConnectUI.sendTransaction(transaction(selectedCard.cost));\n//         console.log('Transaction sent successfully');\n//         console.log('Transaction response:', response);\n//                 // Update TON balance in the state\n//     const updatedWalletAssets = walletAssets.map(asset => \n//         asset.symbol === 'TON' \n//             ? { ...asset, balance: asset.balance + selectedCard.profit } \n//             : asset\n//     );\n//     // Add a new deposit to the deposits state\n//     const newDeposit = {\n//         name: `${selectedCard.title} Card`,\n//         date: new Date(),\n//         amount: selectedCard.profit,\n//         completed: true,\n//     };\n//     const updatedDeposits = [...deposits, newDeposit];\n//         // Update the user's Firestore document with the purchased card\n//         const userRef = doc(db, 'telegramUsers', id.toString());\n//         await updateDoc(userRef, {\n//             specialCards: arrayUnion({\n//                 title: selectedCard.title,\n//                 profit: selectedCard.profit,\n//                 cost: selectedCard.cost,\n//                 icon: selectedCard.icon,\n//                 description: selectedCard.description,\n//                 class: selectedCard.class,\n//             }),\n//             walletAssets: updatedWalletAssets,\n//             'history.deposits': updatedDeposits\n//         });\n//                  // Update local states\n//                 setWalletAssets(updatedWalletAssets);\n//                 setDeposits(updatedDeposits);\n//                 setPurchasedCards(prev => [...prev, selectedCard]);\n//                 setCongratsMessage(\n//                     <div className=\"w-full flex justify-center flex-col items-center space-y-3\">\n//                     <div className=\"w-full items-center justify-center flex flex-col space-y-2\">\n//                       <IoCheckmarkCircleSharp size={32} className={`text-accent`}/>\n//                       <p className='font-medium text-center'>congratulations!</p>\n//                     </div>\n//                     <span className=\"font-medium text-[20px] text-[#ffffff] pt-2 pb-2 flex items-center space-x-1\">\n//                     <img src='/ton.png' alt='refd' className='w-[22px]'/>\n//                       <span className={`text-accent`}>{selectedCard.profit}</span> <span>TON CLAIMED</span>\n//                     </span>\n//                     <p className=\"pb-6 text-[15px] w-full text-center\">\n//                       Your claimed TON will be kept safe in your wallet till token launch. You can also swap your TON for more {texts.projectSymbol} tokens or other listed assets in the wallets menu.\n//                     </p>\n//                   </div>\n//                 );\n//                 // Show the congrats modal\n//                 setShowCongratsModal(true);\n//                 setOpenUpgrade(false);\n//                 setCongrats(true);\n//                 setTimeout(() => {\n//                     setCongrats(false)\n//                 }, 3000);\n//         // Show a success message\n//         setMessage(\"Transaction sent successfully and card purchased!\");\n//         setMessageColor(\"green\");\n//     } catch (err) {\n//         console.error('Transaction error:', err);\n//         if (err instanceof TonConnectError) {\n//             if (err.message.includes('Operation aborted')) {\n//                 setMessage(\"Transaction was cancelled or timed out. Please try again.\");\n//                 setMessageColor(\"orange\");\n//             } else {\n//                 console.error(`TonConnect error: ${err.message}`);\n//             }\n//         } else {\n//             setMessage(\"An unexpected error occurred. Please try again.\");\n//             setMessageColor(\"red\");\n//         }\n//         if (err.response) {\n//             console.error('Error response data:', err.response.data);\n//         }\n//     }\n// };\nvar handleClickOutside=function handleClickOutside(event){if(infoRefTwo.current&&!infoRefTwo.current.contains(event.target)){setOpenUpgrade(false);}};useEffect(function(){if(openUpgrade){document.addEventListener('mousedown',handleClickOutside);}else{document.removeEventListener('mousedown',handleClickOutside);}return function(){document.removeEventListener('mousedown',handleClickOutside);};},[openUpgrade]);var formatNumber=function formatNumber(num){if(num<1000){return num;}else if(num<1000000){return(num/1000).toFixed(1).replace(/\\.0$/,'')+\"k\";}else{return(num/1000000).toFixed(1).replace(/\\.0$/,'')+\"M\";}};var convertNanoToTon=function convertNanoToTon(nanoString){var nanoValue=parseFloat(nanoString);var tonValue=nanoValue/1000000000;return parseFloat(tonValue.toFixed(9)).toString();};return/*#__PURE__*/_jsxs(_Fragment,{children:[specialCards.map(function(card,index){var isPurchased=purchasedCards.some(function(purchasedCard){return purchasedCard.title===card.title;});return/*#__PURE__*/_jsxs(\"button\",{onClick:function onClick(){if(!isPurchased){setSelectedCard(card);setOpenUpgrade(true);}},className:\"\".concat(card.class,\" w-[48%] py-3 relative rounded-[15px] [&:nth-child(2)]:!mt-0 text-[15px] flex flex-col items-center\"),disabled:isPurchased,style:{opacity:isPurchased?0.5:1,cursor:isPurchased?'not-allowed':'pointer'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-[60%] pt-2 rounded-[4px]\",children:/*#__PURE__*/_jsx(\"img\",{src:card.icon,alt:\"\".concat(card.title,\" icon\"),className:\"w-full rounded-[8px] object-cover h-[60px]\"})}),/*#__PURE__*/_jsx(\"h2\",{className:\"pt-1 font-medium\",children:card.title}),/*#__PURE__*/_jsx(\"p\",{className:\"text-[12px] text-secondary\",children:card.tagline}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-1 pt-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-[10px]\",children:\"Profit\"}),/*#__PURE__*/_jsx(\"img\",{src:\"/ton.png\",alt:\"coin\",className:\"w-[12px]\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-[12px] font-semibold\",children:[formatNumber(card.profit),\" TON\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-[80%] h-[1px] bg-[#A5A5A529] mt-[10px]\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center px-3 text-[14px] text-secondary font-semibold py-[6px]\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/ton.png\",alt:\"coin\",className:\"w-[16px]\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"\",children:[convertNanoToTon(card.cost),\" TON\"]})]})}),isPurchased&&/*#__PURE__*/_jsxs(\"div\",{className:\"absolute p\".concat(card.class,\" rounded-[15px] left-0 right-0 top-0 bottom-0 flex justify-center flex-col items-center text-center\"),children:[/*#__PURE__*/_jsx(IoCheckmarkCircle,{size:40,className:\"text-green-500\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"font-medium text-[13px] text-white px-4\",children:\"You now own this special card \\uD83D\\uDE0E\"})]})]},index);}),openUpgrade&&selectedCard&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"fixed flex bottom-0 left-0 z-40 right-0 h-[100vh] bg-[#303030c4] flex-col justify-end items-center\",children:/*#__PURE__*/_jsx(\"div\",{ref:infoRefTwo,className:\"w-full bg-divider shadowtop rounded-tl-[40px] rounded-tr-[40px] relative flex flex-col ease-in duration-300 transition-all justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex taskbg rounded-tl-[40px] rounded-tr-[40px] mt-[2px] justify-center relative flex-col items-center space-y-3 p-4 pt-20 pb-10\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return setOpenUpgrade(false);},className:\"flex items-center justify-center h-[32px] w-[32px] rounded-full bg-[#383838] absolute right-6 top-4 text-center font-medium text-[16px]\",children:/*#__PURE__*/_jsx(IoClose,{size:20,className:\"text-[#9995a4]\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex justify-center flex-col items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-[80px] h-[80px] rounded-[25px] flex items-center justify-center\",children:/*#__PURE__*/_jsx(AiTwotoneInfoCircle,{size:80,className:\"\"})}),/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-[32px]\",children:selectedCard.title}),/*#__PURE__*/_jsx(\"p\",{className:\"pb-6 text-primary text-[14px] px-4 text-center\",children:selectedCard.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"pb-1 text-primary flex items-center justify-center w-full space-x-1 font-semibold text-[15px] px-4 text-center\",children:[/*#__PURE__*/_jsx(\"span\",{children:\" Price:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"pl-1\",children:/*#__PURE__*/_jsx(\"img\",{src:\"ton.png\",alt:\"dfd\",className:\"w-[14px] h-[14px]\"})}),\" \",/*#__PURE__*/_jsx(\"span\",{children:convertNanoToTon(selectedCard.cost)}),\"  \",/*#__PURE__*/_jsx(\"span\",{children:\" TON\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pb-6 text-primary flex items-center justify-center w-full space-x-1 font-semibold text-[15px] px-4 text-center\",children:[/*#__PURE__*/_jsx(\"span\",{children:\" Profit:\"}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"pl-1\",children:/*#__PURE__*/_jsx(\"img\",{src:\"ton.png\",alt:\"dfd\",className:\"w-[14px] h-[14px]\"})}),\" \",/*#__PURE__*/_jsxs(\"span\",{className:\"text-green-500 \",children:[\"+\",selectedCard.profit,\" TON\"]})]})]}),wallet?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-full flex justify-center items-center flex-col space-y-2 pb-7\",children:/*#__PURE__*/_jsx(\"button\",{onClick:handleClick,className:\"\".concat(buttonDisabled?'bg-[#5A4420]':'bg-btn4',\" text-[#000] w-full py-[18px] px-6 text-nowrap flex items-center justify-center text-center rounded-[12px] font-semibold text-[17px]\"),disabled:buttonDisabled,children:buttonText})}),message&&/*#__PURE__*/_jsx(\"p\",{style:{color:messageColor,marginTop:\"10px\"},children:message})]}):/*#__PURE__*/_jsx(\"div\",{className:\"w-full flex flex-col items-center justify-center space-y-4\",children:/*#__PURE__*/_jsx(TonConnectButton,{className:\"!w-full\"})})]})})})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full absolute top-[50px] flex justify-center z-50 pointer-events-none select-none\",children:congrats?/*#__PURE__*/_jsx(\"img\",{src:\"/congrats.gif\",alt:\"congrats\",className:\"w-[80%]\"}):/*#__PURE__*/_jsx(_Fragment,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(showCongratsModal===true?\"visible\":\"invisible\",\" fixed top-[-12px] bottom-0 left-0 z-40 right-0 h-[100vh] bg-[#00000042] flex justify-center items-center backdrop-blur-[6px] px-4\"),children:/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(showCongratsModal===true?\"opacity-100 mt-0 ease-in duration-300\":\"opacity-0 mt-[100px]\",\" w-full bg-modal relative rounded-[16px] flex flex-col justify-center p-8\"),children:[congratsMessage,/*#__PURE__*/_jsx(\"div\",{className:\"w-full flex justify-center\",children:/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return setShowCongratsModal(false);},className:\"bg-btn4 w-full py-[16px] px-6 flex items-center justify-center text-center rounded-[12px] font-medium text-[16px]\",children:\"Continue mining\"})})]})})]});};export default Specials;","map":null,"metadata":{},"sourceType":"module"}